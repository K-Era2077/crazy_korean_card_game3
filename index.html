<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìš¸ëŒ€ í•œêµ­ì–´ 4A ë‹¨ì–´ ê²Œì„</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€ ë° ë ˆì´ì•„ì›ƒ ë³´ì • */
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f7fb;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .game-container {
            background: #ffffff;
            width: 100%;
            max-width: 600px;
            padding: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        h1 { font-size: 1.2rem; text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; font-size: 0.85rem; color: #666; margin-bottom: 15px; }
        
        .top-row { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .chip-label { font-weight: bold; font-size: 14px; margin-right: 5px; }
        .unit-btn { 
            border-radius: 20px; border: 1px solid #d1d5db; background: white;
            padding: 5px 12px; font-size: 14px; cursor: pointer; transition: 0.2s;
        }
        .unit-btn.active { background: #4f46e5; color: white; border-color: #4f46e5; }

        .status-bar { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; }
        
        .card { 
            background: #f0f4ff; border-radius: 14px; padding: 30px 15px; 
            margin-bottom: 15px; text-align: center; 
        }
        .question-text { font-size: 2.2rem; font-weight: bold; color: #333; margin-bottom: 10px; word-break: keep-all; }
        .lang-label { font-size: 0.9rem; color: #6b7280; }

        #options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn {
            padding: 20px 10px; font-size: 1.2rem; border-radius: 10px;
            border: 2px solid #e5e7eb; background: #f9fafb; cursor: pointer;
            transition: all 0.2s; word-break: keep-all; min-height: 80px;
            display: flex; align-items: center; justify-content: center;
        }
        .option-btn.correct { background: #dcfce7 !important; border-color: #22c55e !important; color: #166534; }
        .option-btn.wrong { background: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b; }

        #next-btn {
            margin-top: 20px; width: 100%; padding: 15px; font-size: 1.5rem;
            background: #4f46e5; color: white; border: none; border-radius: 12px;
            cursor: pointer; font-weight: bold;
        }
        #next-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* ì¶•í•˜ íŒì—… ë° ì• ë‹ˆë©”ì´ì…˜ì€ ê¸°ì¡´ ì½”ë“œ ìœ ì§€ */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 100; }
        .overlay.show { display: flex; }
        .celebrate-card { background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 80%; }
        @keyframes fall { 0% { transform: translateY(-50px) rotate(0); } 100% { transform: translateY(600px) rotate(360deg); } }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ì„œìš¸ëŒ€ í•œêµ­ì–´ 4A ë‹¨ì–´ í€´ì¦ˆ</h1>
        <div class="subtitle">ë‹¨ì›ì„ ì„ íƒí•˜ê³  ì—°ìŠµí•´ ë³´ì„¸ìš”!</div>

        <div class="top-row">
            <div class="direction">
                <span class="chip-label">ë°©í–¥:</span>
                <label><input type="radio" name="direction" value="vi2ko" checked> ğŸ‡»ğŸ‡³ â†’ ğŸ‡°ğŸ‡·</label>
                <label><input type="radio" name="direction" value="ko2vi"> ğŸ‡°ğŸ‡· â†’ ğŸ‡»ğŸ‡³</label>
            </div>
            <div class="unit-filter">
                <span class="chip-label">ë‹¨ì›:</span>
                <button class="unit-btn active" data-unit="all">ì „ì²´</button>
                <button class="unit-btn" data-unit="1">1ê³¼</button>
                <button class="unit-btn" data-unit="2">2ê³¼</button>
                <button class="unit-btn" data-unit="3">3ê³¼</button>
                <button class="unit-btn" data-unit="4">4ê³¼</button>
            </div>
        </div>

        <div class="status-bar">
            <span>ë¬¸ì œ: <span id="q-num">1</span></span>
            <span>ì ìˆ˜: <span class="score">0</span></span>
        </div>

        <div class="card">
            <div class="lang-label" id="lang-label">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <div class="question-text" id="q-text">ì¤€ë¹„ ì¤‘...</div>
        </div>

        <div id="options"></div>
        <div id="message" style="text-align:center; margin-top:10px; min-height:1.5em; font-weight:bold;"></div>
        <button id="next-btn" disabled>ë‹¤ìŒ ë¬¸ì œ</button>
    </div>

    <div class="overlay" id="overlay">
        <div class="celebrate-card">
            <h2>ğŸ‰ <span class="score"></span>ì  ëŒíŒŒ! ğŸ‰</h2>
            <p>ëŒ€ë‹¨í•´ìš”! ê³„ì†í•´ì„œ ì‹¤ë ¥ì„ ìŒ“ì•„ë³´ì„¸ìš”.</p>
            <button class="unit-btn active" id="close-overlay" style="padding:10px 20px;">ê³„ì†í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // ì˜¤ë””ì˜¤ ì†ŒìŠ¤ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë”ë¯¸ ì²˜ë¦¬
        const CHEER_AUDIO_SRC = "your_audio_base64_or_url_here"; 
        const cheerAudio = new Audio(CHEER_AUDIO_SRC);

        let WORDS_ALL = [];
        let WORDS = [];
        let score = 0;
        let current = 1;
        let celebratedScore = 0;
        let answer = null;
        let direction = "vi2ko";
        let currentUnitFilter = "all";

        const qText = document.getElementById("q-text");
        const langLabel = document.getElementById("lang-label");
        const optionsEl = document.getElementById("options");
        const messageEl = document.getElementById("message");
        const qNumEl = document.getElementById("q-num");
        const nextBtn = document.getElementById("next-btn");

        function updateScore() {
            document.querySelectorAll('.score').forEach(e => e.textContent = score);
            if (score > 0 && score % 300 === 0 && celebratedScore !== score) {
                showCelebration();
                celebratedScore = score;
            }
        }

        function showCelebration() {
            document.getElementById("overlay").classList.add("show");
            cheerAudio.play().catch(() => console.log("ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨"));
        }

        function shuffle(arr) {
            return arr.sort(() => Math.random() - 0.5);
        }

        function applyFilter() {
            if (!WORDS_ALL.length) return;
            WORDS = currentUnitFilter === "all" ? [...WORDS_ALL] : WORDS_ALL.filter(w => w.unit == currentUnitFilter);
            
            current = 1;
            score = 0;
            updateScore();
            if (WORDS.length > 0) {
                nextBtn.disabled = false;
                newQuestion();
            } else {
                qText.textContent = "ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.";
                optionsEl.innerHTML = "";
            }
        }

        function newQuestion() {
            messageEl.textContent = "";
            nextBtn.disabled = true;
            qNumEl.textContent = current;

            const word = WORDS[Math.floor(Math.random() * WORDS.length)];
            const isVi2Ko = direction === "vi2ko";
            
            answer = isVi2Ko ? word.korean : word.vietnamese;
            qText.textContent = isVi2Ko ? word.vietnamese : word.korean;
            langLabel.textContent = isVi2Ko ? "í•œêµ­ì–´ ë‹¨ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”" : "ë² íŠ¸ë‚¨ì–´ ëœ»ì„ ì„ íƒí•˜ì„¸ìš”";

            // ì˜¤ë‹µ ìƒì„± (ì •ë‹µê³¼ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡)
            let others = WORDS
                .filter(w => (isVi2Ko ? w.korean : w.vietnamese) !== answer)
                .map(w => (isVi2Ko ? w.korean : w.vietnamese));
            
            // ì¤‘ë³µ í…ìŠ¤íŠ¸ ì œê±° (set í™œìš©)
            others = [...new Set(others)];
            const choices = shuffle([answer, ...shuffle(others).slice(0, 3)]);

            optionsEl.innerHTML = "";
            choices.forEach(choice => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.textContent = choice;
                btn.onclick = () => check(choice, btn);
                optionsEl.appendChild(btn);
            });
        }

        function check(choice, btn) {
            const buttons = document.querySelectorAll(".option-btn");
            buttons.forEach(b => {
                b.disabled = true;
                if (b.textContent === answer) b.classList.add("correct");
            });

            if (choice === answer) {
                messageEl.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ˜Š";
                messageEl.style.color = "#16a34a";
                score += 1; // ì ìˆ˜ ê°€ì¤‘ì¹˜ ë¶€ì—¬ ê°€ëŠ¥
            } else {
                messageEl.textContent = "ì˜¤ë‹µì…ë‹ˆë‹¤! ğŸ˜¢";
                messageEl.style.color = "#dc2626";
                btn.classList.add("wrong");
            }
            updateScore();
            nextBtn.disabled = false;
        }

        nextBtn.onclick = () => {
            current++;
            newQuestion();
        };

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.querySelectorAll('input[name="direction"]').forEach(r => {
            r.onchange = (e) => { direction = e.target.value; applyFilter(); };
        });

        document.querySelectorAll(".unit-btn").forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll(".unit-btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                currentUnitFilter = btn.dataset.unit;
                applyFilter();
            };
        });

        document.getElementById("close-overlay").onclick = () => {
            document.getElementById("overlay").classList.remove("show");
        };

        // ë°ì´í„° ë¡œë”©
        const jsonFiles = ['words_1.json', 'words_2.json', 'words_3.json', 'words_4.json'];
        Promise.all(jsonFiles.map(f => fetch(f).then(r => r.json())))
            .then(data => {
                WORDS_ALL = data.flat();
                applyFilter();
            })
            .catch(err => {
                langLabel.textContent = "ì—ëŸ¬ ë°œìƒ";
                qText.textContent = "íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            });
    </script>
</body>
</html>